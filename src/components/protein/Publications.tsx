import { useEffect, useState } from 'react';
import { getProteinPublications } from 'src/api/uniprot';

export default function Publications({ id }: { id: string }) {
	const [pubs, setPubs] = useState<Pubs[] | undefined>();
	const [err, setErr] = useState<string | undefined>();
	useEffect(() => {
		getProteinPublications(id!)
			.then((data) => {
				setPubs(data.result.results);
				console.log(data.result.results);
			})
			.catch((err) => setErr(err.message));
	}, []);
	return (
		<div className="pt-4">
			{err && (
				<p className="text-center text-red-600 text-xl">
					Sorry, there seems to be an error!: <br /> {err}
				</p>
			)}
			{pubs &&
				pubs.map((pub) => {
					return (
						<div
							key={pub?.citation.id}
							className="p-4 my-4 rounded-xl bg-slate-100"
						>
							<h3 className="text-lg font-semibold">{pub.citation.title}</h3>
							<p className="max-h-12 mb-4 overflow-hidden text-ellipsis">
								{pub.citation.authors?.map((author, index) => (
									<span
										key={author + pub.citation.id + index}
										className="pr-2 underline"
									>
										{author}
									</span>
								))}
							</p>
							<p className="mt-2">
								<span className="text-slate-600 font-semibold">
									Categories:{' '}
								</span>
								<span className="pr-2 ">
									{pub.references![0].sourceCategories?.join(', ')}
								</span>
							</p>
							<p className="mt-2">
								<span className="text-slate-600 font-semibold">
									Cited for:{' '}
								</span>

								<span className="pr-2 ">
									{pub.references![0].referencePositions?.join(', ') || ''}
								</span>
							</p>
							<p className="mt-2">
								<span className="text-slate-600 font-semibold">Source: </span>
								<span className="pr-2 ">{pub.references![0].source.name}</span>
							</p>
							{pub.citation.citationCrossReferences && (
								<>
									<div className="flex gap-8">
										{pub.citation.citationCrossReferences.map((ref) => {
											//! Bad
											const hasDOI =
												/* Boolean(pub.citation.citationCrossReferences?.find((ref)=>ref.database==='DOI')) */ pub
													.citation.citationCrossReferences?.length === 2;
											return (
												<div
													className="mt-2 flex gap-8"
													key={ref.database + ref.id}
												>
													{ref.database === 'PubMed' && (
														<>
															<a
																className="group m-2 p-2 flex justify-center items-baseline ring-2 ring-blue-400 rounded-xl hover:bg-blue-400 hover:text-white"
																href={`https://pubmed.ncbi.nlm.nih.gov/${ref.id}`}
															>
																Pubmed
																<svg
																	className="ml-4 group-hover:grayscale group-hover:brightness-[4]"
																	width="14"
																	height="14"
																	viewBox="0 0 14 14"
																	fill="none"
																	xmlns="http://www.w3.org/2000/svg"
																>
																	<path
																		d="M8.55556 1.55556C8.34928 1.55556 8.15145 1.47361 8.00558 1.32775C7.85972 1.18189 7.77778 0.984057 7.77778 0.777778C7.77778 0.571498 7.85972 0.373667 8.00558 0.227806C8.15145 0.0819442 8.34928 0 8.55556 0H13.2222C13.4285 0 13.6263 0.0819442 13.7722 0.227806C13.9181 0.373667 14 0.571498 14 0.777778V5.44444C14 5.65072 13.9181 5.84855 13.7722 5.99442C13.6263 6.14028 13.4285 6.22222 13.2222 6.22222C13.0159 6.22222 12.8181 6.14028 12.6722 5.99442C12.5264 5.84855 12.4444 5.65072 12.4444 5.44444V2.65533L5.21656 9.88322C5.06986 10.0249 4.8734 10.1033 4.66947 10.1015C4.46554 10.0998 4.27046 10.018 4.12625 9.87375C3.98205 9.72954 3.90025 9.53446 3.89848 9.33053C3.8967 9.1266 3.9751 8.93014 4.11678 8.78344L11.3447 1.55556H8.55556ZM0 3.11111C0 2.69855 0.163888 2.30289 0.455612 2.01117C0.747335 1.71944 1.143 1.55556 1.55556 1.55556H5.44444C5.65072 1.55556 5.84855 1.6375 5.99442 1.78336C6.14028 1.92922 6.22222 2.12705 6.22222 2.33333C6.22222 2.53961 6.14028 2.73744 5.99442 2.88331C5.84855 3.02917 5.65072 3.11111 5.44444 3.11111H1.55556V12.4444H10.8889V8.55556C10.8889 8.34928 10.9708 8.15145 11.1167 8.00558C11.2626 7.85972 11.4604 7.77778 11.6667 7.77778C11.8729 7.77778 12.0708 7.85972 12.2166 8.00558C12.3625 8.15145 12.4444 8.34928 12.4444 8.55556V12.4444C12.4444 12.857 12.2806 13.2527 11.9888 13.5444C11.6971 13.8361 11.3014 14 10.8889 14H1.55556C1.143 14 0.747335 13.8361 0.455612 13.5444C0.163888 13.2527 0 12.857 0 12.4444V3.11111Z"
																		fill="#3C86F4"
																	/>
																</svg>
															</a>
															<a
																className="group m-2 p-2 flex justify-center items-baseline ring-2 ring-blue-400 rounded-xl hover:bg-blue-400 hover:text-white"
																href={`https://europepmc.org/article/MED/${ref.id}`}
															>
																Europe PMC
																<svg
																	className="ml-4 group-hover:grayscale group-hover:brightness-[4]"
																	width="14"
																	height="14"
																	viewBox="0 0 14 14"
																	fill="none"
																	xmlns="http://www.w3.org/2000/svg"
																>
																	<path
																		d="M8.55556 1.55556C8.34928 1.55556 8.15145 1.47361 8.00558 1.32775C7.85972 1.18189 7.77778 0.984057 7.77778 0.777778C7.77778 0.571498 7.85972 0.373667 8.00558 0.227806C8.15145 0.0819442 8.34928 0 8.55556 0H13.2222C13.4285 0 13.6263 0.0819442 13.7722 0.227806C13.9181 0.373667 14 0.571498 14 0.777778V5.44444C14 5.65072 13.9181 5.84855 13.7722 5.99442C13.6263 6.14028 13.4285 6.22222 13.2222 6.22222C13.0159 6.22222 12.8181 6.14028 12.6722 5.99442C12.5264 5.84855 12.4444 5.65072 12.4444 5.44444V2.65533L5.21656 9.88322C5.06986 10.0249 4.8734 10.1033 4.66947 10.1015C4.46554 10.0998 4.27046 10.018 4.12625 9.87375C3.98205 9.72954 3.90025 9.53446 3.89848 9.33053C3.8967 9.1266 3.9751 8.93014 4.11678 8.78344L11.3447 1.55556H8.55556ZM0 3.11111C0 2.69855 0.163888 2.30289 0.455612 2.01117C0.747335 1.71944 1.143 1.55556 1.55556 1.55556H5.44444C5.65072 1.55556 5.84855 1.6375 5.99442 1.78336C6.14028 1.92922 6.22222 2.12705 6.22222 2.33333C6.22222 2.53961 6.14028 2.73744 5.99442 2.88331C5.84855 3.02917 5.65072 3.11111 5.44444 3.11111H1.55556V12.4444H10.8889V8.55556C10.8889 8.34928 10.9708 8.15145 11.1167 8.00558C11.2626 7.85972 11.4604 7.77778 11.6667 7.77778C11.8729 7.77778 12.0708 7.85972 12.2166 8.00558C12.3625 8.15145 12.4444 8.34928 12.4444 8.55556V12.4444C12.4444 12.857 12.2806 13.2527 11.9888 13.5444C11.6971 13.8361 11.3014 14 10.8889 14H1.55556C1.143 14 0.747335 13.8361 0.455612 13.5444C0.163888 13.2527 0 12.857 0 12.4444V3.11111Z"
																		fill="#3C86F4"
																	/>
																</svg>
															</a>
														</>
													)}{' '}
													{ref.database === 'DOI' ? (
														<a
															className="group m-2 p-2 flex justify-center items-baseline ring-2 rounded-xl ring-blue-400 hover:bg-blue-400 hover:text-white"
															href={`https://dx.doi.org/${ref.id}`}
														>
															{pub.citation.journal +
																' ' +
																pub.citation.volume +
																' ' +
																pub.citation.firstPage +
																' - ' +
																pub.citation.lastPage +
																' (' +
																pub.citation.publicationDate +
																')'}
															<svg
																className={
																	'ml-4 group-hover:grayscale group-hover:brightness-[4]'
																}
																width="14"
																height="14"
																viewBox="0 0 14 14"
																fill="none"
																xmlns="http://www.w3.org/2000/svg"
															>
																<path
																	d="M8.55556 1.55556C8.34928 1.55556 8.15145 1.47361 8.00558 1.32775C7.85972 1.18189 7.77778 0.984057 7.77778 0.777778C7.77778 0.571498 7.85972 0.373667 8.00558 0.227806C8.15145 0.0819442 8.34928 0 8.55556 0H13.2222C13.4285 0 13.6263 0.0819442 13.7722 0.227806C13.9181 0.373667 14 0.571498 14 0.777778V5.44444C14 5.65072 13.9181 5.84855 13.7722 5.99442C13.6263 6.14028 13.4285 6.22222 13.2222 6.22222C13.0159 6.22222 12.8181 6.14028 12.6722 5.99442C12.5264 5.84855 12.4444 5.65072 12.4444 5.44444V2.65533L5.21656 9.88322C5.06986 10.0249 4.8734 10.1033 4.66947 10.1015C4.46554 10.0998 4.27046 10.018 4.12625 9.87375C3.98205 9.72954 3.90025 9.53446 3.89848 9.33053C3.8967 9.1266 3.9751 8.93014 4.11678 8.78344L11.3447 1.55556H8.55556ZM0 3.11111C0 2.69855 0.163888 2.30289 0.455612 2.01117C0.747335 1.71944 1.143 1.55556 1.55556 1.55556H5.44444C5.65072 1.55556 5.84855 1.6375 5.99442 1.78336C6.14028 1.92922 6.22222 2.12705 6.22222 2.33333C6.22222 2.53961 6.14028 2.73744 5.99442 2.88331C5.84855 3.02917 5.65072 3.11111 5.44444 3.11111H1.55556V12.4444H10.8889V8.55556C10.8889 8.34928 10.9708 8.15145 11.1167 8.00558C11.2626 7.85972 11.4604 7.77778 11.6667 7.77778C11.8729 7.77778 12.0708 7.85972 12.2166 8.00558C12.3625 8.15145 12.4444 8.34928 12.4444 8.55556V12.4444C12.4444 12.857 12.2806 13.2527 11.9888 13.5444C11.6971 13.8361 11.3014 14 10.8889 14H1.55556C1.143 14 0.747335 13.8361 0.455612 13.5444C0.163888 13.2527 0 12.857 0 12.4444V3.11111Z"
																	fill="#3C86F4"
																/>
															</svg>
														</a>
													) : (
														!hasDOI && (
															<p className="cursor-not-allowed m-2 p-2 flex justify-center items-baseline ring-2 rounded-xl ring-slate-400">
																{pub.citation.journal +
																	' ' +
																	pub.citation.volume +
																	' ' +
																	pub.citation.firstPage +
																	' - ' +
																	pub.citation.lastPage +
																	' (' +
																	pub.citation.publicationDate +
																	')'}
																<svg
																	className="ml-4 grayscale"
																	width="14"
																	height="14"
																	viewBox="0 0 14 14"
																	fill="none"
																	xmlns="http://www.w3.org/2000/svg"
																>
																	<path
																		d="M8.55556 1.55556C8.34928 1.55556 8.15145 1.47361 8.00558 1.32775C7.85972 1.18189 7.77778 0.984057 7.77778 0.777778C7.77778 0.571498 7.85972 0.373667 8.00558 0.227806C8.15145 0.0819442 8.34928 0 8.55556 0H13.2222C13.4285 0 13.6263 0.0819442 13.7722 0.227806C13.9181 0.373667 14 0.571498 14 0.777778V5.44444C14 5.65072 13.9181 5.84855 13.7722 5.99442C13.6263 6.14028 13.4285 6.22222 13.2222 6.22222C13.0159 6.22222 12.8181 6.14028 12.6722 5.99442C12.5264 5.84855 12.4444 5.65072 12.4444 5.44444V2.65533L5.21656 9.88322C5.06986 10.0249 4.8734 10.1033 4.66947 10.1015C4.46554 10.0998 4.27046 10.018 4.12625 9.87375C3.98205 9.72954 3.90025 9.53446 3.89848 9.33053C3.8967 9.1266 3.9751 8.93014 4.11678 8.78344L11.3447 1.55556H8.55556ZM0 3.11111C0 2.69855 0.163888 2.30289 0.455612 2.01117C0.747335 1.71944 1.143 1.55556 1.55556 1.55556H5.44444C5.65072 1.55556 5.84855 1.6375 5.99442 1.78336C6.14028 1.92922 6.22222 2.12705 6.22222 2.33333C6.22222 2.53961 6.14028 2.73744 5.99442 2.88331C5.84855 3.02917 5.65072 3.11111 5.44444 3.11111H1.55556V12.4444H10.8889V8.55556C10.8889 8.34928 10.9708 8.15145 11.1167 8.00558C11.2626 7.85972 11.4604 7.77778 11.6667 7.77778C11.8729 7.77778 12.0708 7.85972 12.2166 8.00558C12.3625 8.15145 12.4444 8.34928 12.4444 8.55556V12.4444C12.4444 12.857 12.2806 13.2527 11.9888 13.5444C11.6971 13.8361 11.3014 14 10.8889 14H1.55556C1.143 14 0.747335 13.8361 0.455612 13.5444C0.163888 13.2527 0 12.857 0 12.4444V3.11111Z"
																		fill="#3C86F4"
																	/>
																</svg>
															</p>
														)
													)}
												</div>
											);
										})}
									</div>
								</>
							)}
						</div>
					);
				})}
		</div>
	);
}
